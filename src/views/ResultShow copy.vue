<!--
  页面说明：
  本页面用于展示【基准股票模式评价】的结果，包括结果表格和每条结果的均线图，支持保存配置和下载结果等操作。
-->
<template>
  <div id="app">

    <!--结果详情展示-->
    <div style="text-align: left; margin-top: 40px; background-color:#faf8e1; height: 30px; margin-top: 5px; display: inline-flex; width: 99%;border-radius: 10px; margin-left: -5px;">
      <span style="font-weight: bold; margin-top: 5px; margin-left: 20px; font-size: 14px;">模式相似性查找结果详情</span>
    </div>

    <div v-if="isChooseStock" style="display: flex; height: 290px;">
      <!-- <div style="width: 77%; height: 100px;">
        <Graph style="margin-left: -40px; margin-top: -15px;" :code="graphCode" :startDate="resultStockInfo.startDate" :endDate="resultStockInfo.endDate" :checkListMAOption="store.state.modeInfo.lines2" :width="1040" :height="300" :legendData="store.state.modeInfo.lines2" />
      </div>
      <div style="width: 21%; background-color: #f3f3f3; height: 90px; border-radius: 10px; margin-left: 15px; margin-top: 10px;">
        <div class="horizontal-table-container">
          <el-table 
            :data="tableData1"
            :show-header="false"
            style="width: 90%; border-radius: 10px; margin-left: 10px; margin-top: 10px;"
          >
            <el-table-column>
              <template #default="scope">
                <div style="margin-top: 5px;"></div>
                <span style="font-size: 13px">{{ scope.row.name }}</span>
                <div style="margin-top: 5px;"></div>
              </template>
            </el-table-column>
            <el-table-column>
              <template #default="scope">
                <div style="margin-top: 5px;"></div>
                <span style="font-size: 13px">{{ scope.row.age }}</span>
                <div style="margin-top: 5px;"></div>
              </template>
            </el-table-column>
          </el-table>
        </div>
      </div> -->
      <el-table :data="tableData2" border style="width: 99%; margin-left: 5px; margin-top: 5px; " stripe class="result-table" 
        :cell-style="{ textAlign: 'center' }" :header-cell-style="{ textAlign: 'center' }">
          <el-table-column fixed label="股票名称" prop="stockName" width="100px"></el-table-column>
          <el-table-column fixed label="股票代码" prop="stockCode" width="100px"></el-table-column>
          <el-table-column label="股票来源" prop="stockFrom" width="100px"></el-table-column>
          <el-table-column label="起始时间" prop="startDate"  width="100px"></el-table-column>
          <el-table-column label="终止时间" prop="endDate"  width="100px"></el-table-column>
          <el-table-column label="基准区域" width="300px">
            <template #default="{ $index }">
              <div :ref="(el) => setChartRef2(el, $index, 0)" style="width: 280px; height: 200px; margin-top: -20px; margin-bottom: -40px; margin-left: 40px;"></div>
            </template>
          </el-table-column>

          <el-table-column label="相似性选股结果（近N日）" width="300px">
            <template #default="{ $index }">
              <div :ref="(el) => setChartRef(el, $index, 0)" style="width: 280px; height: 200px; margin-top: -20px; margin-bottom: -40px; margin-left: 40px;"></div>
            </template>
          </el-table-column>
          <el-table-column label="相似度" prop="similarity"></el-table-column>
      </el-table>
    
    </div>
    
    <div v-if="isHistorySearch">
      <el-table :data="tableData" border style="width: 99%; margin-left: 5px; margin-top: 5px;" stripe class="result-table" 
        :cell-style="{ textAlign: 'center' }" :header-cell-style="{ textAlign: 'center' }">
          <el-table-column fixed label="序号" prop="stockIndex" width="60px"></el-table-column>
          <el-table-column fixed label="股票名称" prop="stockName" width="90px"></el-table-column>
          <el-table-column fixed label="股票代码" prop="stockCode" width="90px"></el-table-column>
          <el-table-column label="股票来源" prop="stockFrom" width="100px"></el-table-column>
          <el-table-column label="起始时间" prop="startDate"  width="100px"></el-table-column>
          <el-table-column label="终止时间" prop="endDate"  width="100px"></el-table-column>
          <el-table-column label="基础MA指标图" width="530px">
            <template #default="{ $index }">
              <div :ref="(el) => setChartRef(el, $index, 0)" style="width: 520px; height: 200px; margin-top: -10px; margin-bottom: -30px; margin-left: 20px;"></div>
            </template>
          </el-table-column>
          <el-table-column label="相似度" prop="similarity"></el-table-column>
      </el-table>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, nextTick, watch, toRaw, computed  } from 'vue';
import { useStore } from "vuex";
import * as echarts from 'echarts';
import Graph from "@/views/Graph.vue";

const store = useStore();
const resultStockInfo = store.state.resultStockInfo;
const isHistorySearch = computed(() => {
  return store.state.baseInfo.isHistorySearch === true;
});
const isChooseStock = computed(() => {
  return store.state.baseInfo.isChooseStock === true;
});
const graphCode = ref('000021');
const graphCode1 = ref('000021');

// 用于强制更新Graph组件的key
const componentKey = ref(Date.now());

watch(() => store.state.resultStockInfo.code,(newValue) => {
  console.log("----------------------------------");
  console.log(store.state.resultStockInfo.startDate);
  console.log(store.state.resultStockInfo.endDate);
  console.log("----------------------------------");
  graphCode.value = newValue;
  }
);

// 表格数据
const tableData1 = ref([
  { name: '起始时间', age: '2024-09-26' },
  { name: '终止时间', age: '2024-10-28' },
])
// -------------------------
function getDateRange(dateStr) {
    const date = new Date(`${dateStr.slice(0, 4)}-${dateStr.slice(4, 6)}-${dateStr.slice(6)}`);
    const range = [];
    for (let i = -2; i <= 2; i++) {
        const newDate = new Date(date);
        newDate.setDate(newDate.getDate() + i);
        const year = newDate.getFullYear();
        const month = String(newDate.getMonth() + 1).padStart(2, '0');
        const day = String(newDate.getDate()).padStart(2, '0');
        range.push(`${year}${month}${day}`);
    }
    return range;
}

// 根据涨幅正负设置标签样式
const getTagType = (value) => {
  return value < 0 ? 'success' : value > 0 ? 'danger' : 'info'
}

// // 根据涨幅正负设置标签样式
// const getTagType1 = (value) => {
//   return value > 0 ? 'success' : value < 0 ? 'danger' : 'info'
// }
// const setChartRef1 = (el, rowIndex, colIndex) => {
//   if (el) {
//     nextTick(() => {
//       initChart1(el, rowIndex)
//     })
//   }
// }
// const initChart1 = (el, rowIndex) => {
//   const chart = echarts.init(el)
//   const data = resultData.value[rowIndex].riseFallRatio
//   const option = {
//     series: [
//       {
//         name: '涨跌比例',
//         type: 'pie',
//         radius: ['30%', '80%'],
//         avoidLabelOverlap: true, // 开启标签重叠避免
//         label: {
//           show: true,
//           position: 'inside', // 标签放在饼图内部
//           formatter: '{b}\n{c}%', // 名称和百分比分行显示
//           fontSize: 11,
//           color: '#fff', // 白色文字，确保在深色区域可见
//           backgroundColor: 'transparent', // 透明背景
//           fontWeight: 'bold'
//         },
//         labelLine: {
//           show: false // 不显示指示线
//         },
//         data: [
//           { value: data[0], name: '跌', itemStyle: { color: '#10b981' } }, // 绿色
//           { value: data[1], name: '涨', itemStyle: { color: '#ef4444' } }  // 红色
//         ]
//       }
//     ]
//   }
//   chart.setOption(option)
//   window.addEventListener('resize', () => {
//     chart.resize()
//   })
// }

// -------------------------------------------------------------------
const dataObjects = ref([
  {
    stockIndex: 1,
    stockName: '博菲电器',
    stockCode: '001255',
    stockFrom: '基准股票',
    startDate: '2024-09-20',
    endDate: '2024-11-20',
    chartData: [
      [6.507500, 6.707500, 6.910000, 7.110000, 7.155000, 7.217500, 7.442500, 7.732500, 7.807500, 7.842500, 7.652500, 7.460000, 7.472500, 7.492500, 7.605000, 7.650000, 7.777500, 7.852500, 7.960000, 8.027500, 8.217500, 8.667500, 9.102500, 9.662500, 10.185000, 10.215000, 10.147500, 10.040000, 9.835000, 9.857500, 9.972500, 10.072500, 10.002500, 10.030000, 9.932500, 9.692500, 9.497500, 9.267500, 9.207500],
      [6.426250, 6.552500, 6.635000, 6.740000, 6.831250, 6.962500, 7.176250, 7.421250, 7.481250, 7.530000, 7.547500, 7.596250, 7.640000, 7.667500, 7.628750, 7.555000, 7.625000, 7.672500, 7.782500, 7.838750, 7.997500, 8.260000, 8.531250, 8.845000, 9.201250, 9.441250, 9.625000, 9.851250, 10.010000, 10.036250, 10.060000, 10.056250, 9.918750, 9.943750, 9.952500, 9.882500, 9.750000, 9.648750, 9.570000],
      [6.347500, 6.425833, 6.500000, 6.575833, 6.669167, 6.774167, 6.904167, 7.070833, 7.156667, 7.255833, 7.335000, 7.434167, 7.478333, 7.517500, 7.566667, 7.614167, 7.685833, 7.729167, 7.739167, 7.712500, 7.822500, 8.004167, 8.222500, 8.446667, 8.726667, 8.911667, 9.070000, 9.243333, 9.412500, 9.580000, 9.740833, 9.925000, 10.007500, 10.034167, 10.017500, 9.935000, 9.778333, 9.718333, 9.704167],
      [6.301250, 6.367500, 6.421875, 6.480000, 6.549375, 6.623750, 6.735625, 6.865000, 6.953750, 7.041250, 7.091250, 7.168125, 7.235625, 7.315000, 7.402500, 7.488125, 7.553125, 7.601250, 7.665000, 7.717500, 7.818750, 7.963750, 8.080000, 8.200000, 8.413125, 8.556875, 8.703750, 8.845000, 9.003750, 9.148125, 9.295625, 9.450625, 9.560000, 9.692500, 9.788750, 9.866875, 9.880000, 9.842500, 9.815000],
      [6.387500, 6.409500, 6.410000, 6.429000, 6.472000, 6.537500, 6.626000, 6.730500, 6.801000, 6.867500, 6.919000, 6.984000, 7.057500, 7.131500, 7.194000, 7.264500, 7.344000, 7.422500, 7.514000, 7.596000, 7.686000, 7.814500, 7.952500, 8.106500, 8.292000, 8.414000, 8.493500, 8.568000, 8.697500, 8.817000, 8.957500, 9.090500, 9.203500, 9.324500, 9.423000, 9.499000, 9.547500, 9.607500, 9.672500], 
      [6.310851, 6.337872, 6.362128, 6.391702, 6.421489, 6.452979, 6.493404, 6.545319, 6.581489, 6.615532, 6.635957, 6.663191, 6.687447, 6.707872, 6.726809, 6.750426, 6.785745, 6.813830, 6.841489, 6.874468, 6.925745, 6.997660, 7.070851, 7.154894, 7.252553, 7.328511, 7.398511, 7.477447, 7.549787, 7.611277, 7.678936, 7.761702, 7.841277, 7.923404, 7.994468, 8.062128, 8.122553, 8.185532, 8.251064],
    ],
    chartData2: [],
    // 2024-09-20 到 2024-11-20 的每个股票交易日
    dates: [ '20240920', '20240921', '20240922', '20240923', '20240924', '20240925', '20240926', '20240927', '20240928', '20240929',
      '20240930', '20241001', '20241002', '20241003', '20241004', '20241005', '20241006', '20241007', '20241008', '20241009',
      '20241030', '20241031', '20241101', '20241102', '20241101', '20241102',
      '20241109', '20241110', '20241111', '20241112', '20241113', '20241114', '20241115', '20241116', '20241117', '20241118',
      '20241119', '20241120'
    ],
    dates2: getDateRange('20241120'),
    chartData3: [],
    similarity: 0.9232
  },
  {
    stockIndex: 2,
    stockName: '博菲电器',
    stockCode: '001255',
    stockFrom: '基准股票',
    startDate: '2023-02-02',
    endDate: '2023-03-20',
    chartData: [
      [10.602500, 10.647500, 10.687500, 10.675000, 10.672500, 10.707500, 10.727500, 10.815000, 10.887500, 10.992500, 11.025000, 10.950000, 10.937500, 10.867500, 10.892500, 10.927500, 10.985000, 10.980000, 10.985000, 11.067500, 11.172500, 11.342500, 11.552500, 11.577500, 11.705000, 11.752500, 11.662500, 11.752500, 11.667500, 11.575000, 11.437500, 11.327500, 11.185000], 
  [10.343750, 10.435000, 10.513750, 10.585000, 10.637500, 10.677500, 10.707500, 10.745000, 10.780000, 10.850000, 10.876250, 10.882500, 10.912500, 10.930000, 10.958750, 10.938750, 10.961250, 10.923750, 10.938750, 10.997500, 11.078750, 11.161250, 11.268750, 11.322500, 11.438750, 11.547500, 11.607500, 11.665000, 11.686250, 11.663750, 11.550000, 11.540000, 11.426250],
  [10.114167, 10.207500, 10.305833, 10.393333, 10.453333, 10.525833, 10.585000, 10.661667, 10.720833, 10.782500, 10.813333, 10.813333, 10.832500, 10.855833, 10.881667, 10.897500, 10.936667, 10.946667, 10.967500, 10.981667, 11.031667, 11.063333, 11.143333, 11.190833, 11.287500, 11.358333, 11.400000, 11.465833, 11.515000, 11.556667, 11.550833, 11.552500, 11.519167], 
  [10.016875, 10.075000, 10.136250, 10.194375, 10.253750, 10.332500, 10.411250, 10.498750, 10.561875, 10.642500, 10.695000, 10.733750, 10.775000, 10.803750, 10.833125, 10.841875, 10.870625, 10.886875, 10.907500, 10.940000, 10.995625, 11.045625, 11.113750, 11.130625, 11.200000, 11.235625, 11.273125, 11.331250, 11.382500, 11.412500, 11.409375, 11.431250, 11.432500],  
  [9.919500, 9.986500, 10.054500, 10.104500, 10.148000, 10.201500, 10.254500, 10.318500, 10.380500, 10.464500, 10.534000, 10.589000, 10.637000, 10.687500, 10.734500, 10.772500, 10.817000, 10.839000, 10.863500, 10.887000, 10.931000, 10.978000, 11.036500, 11.067500, 11.137500, 11.187000, 11.223500, 11.255000, 11.293500, 11.303500, 11.306000, 11.330500, 11.343000], 
  [10.035106, 10.035532, 10.041064, 10.047872, 10.054894, 10.068298, 10.079362, 10.095319, 10.105319, 10.123830, 10.131064, 10.134255, 10.140638, 10.152979, 10.168936, 10.180426, 10.199574, 10.217872, 10.238298, 10.265745, 10.303404, 10.343191, 10.391277, 10.429149, 10.482340, 10.527872, 10.567872, 10.614043, 10.663404, 10.706596, 10.734468, 10.767021, 10.795532],  

    ],
    chartData2: [],
    dates: [ '20230202', '20230203', '20230204', '20230205', '20230206', '20230207', '20230208', '20230209', '20230210', '20230211',
      '20230212', '20230213', '20230214', '20230215', '20230216', '20230217', '20230218', '20230219', '20230220', '20230221',
      '20230302', '20230303', '20230304', '20230305', '20230306', '20230307',
      '20230314', '20230315', '20230316', '20230317', '20230318', '20230319',
      '20230320'
    ],
    dates2: getDateRange('20250102'),
    chartData3: [],
    similarity: 0.8997
  },
  {
    stockIndex: 3,
    stockName: '博菲电器',
    stockCode: '001255',
    stockFrom: '基准股票',
    startDate: '2024-09-24',
    endDate: '2024-11-19',
    chartData: [
      [13.040000, 13.265000, 13.592500, 14.035000, 14.562500, 15.297500, 15.770000, 16.152500, 16.170000, 16.010000, 16.095000, 16.052500, 16.127500, 16.170000, 16.342500, 16.647500, 17.150000, 17.675000, 18.290000, 18.987500, 19.280000, 19.350000, 19.475000, 19.332500, 19.895000, 20.690000, 20.950000, 21.870000, 22.002500, 22.130000, 22.182500, 21.685000, 21.285000, 20.512500, 20.052500, 19.760000], 
  [12.965000, 13.055000, 13.192500, 13.426250, 13.801250, 14.281250, 14.681250, 15.093750, 15.366250, 15.653750, 15.932500, 16.102500, 16.148750, 16.090000, 16.218750, 16.350000, 16.638750, 16.922500, 17.316250, 17.817500, 18.215000, 18.512500, 18.882500, 19.160000, 19.587500, 20.020000, 20.212500, 20.601250, 20.948750, 21.410000, 21.566250, 21.777500, 21.643750, 21.321250, 21.117500, 20.722500],  
  [13.050000, 13.075833, 13.156667, 13.292500, 13.497500, 13.802500, 14.051667, 14.335000, 14.590833, 14.857500, 15.152500, 15.413333, 15.620000, 15.825833, 16.069167, 16.284167, 16.482500, 16.618333, 16.909167, 17.229167, 17.519167, 17.731667, 18.035833, 18.322500, 18.775000, 19.238333, 19.571667, 20.063333, 20.392500, 20.723333, 20.869167, 20.962500, 21.060833, 21.110833, 21.061667, 21.105000],  
  [13.140625, 13.163125, 13.221875, 13.295625, 13.428125, 13.631250, 13.810000, 14.007500, 14.165625, 14.354375, 14.562500, 14.764375, 14.975000, 15.185625, 15.450000, 15.721875, 16.002500, 16.288125, 16.624375, 16.960000, 17.181875, 17.301250, 17.550625, 17.755000, 18.113125, 18.471250, 18.764375, 19.209375, 19.581875, 19.961250, 20.224375, 20.468750, 20.615625, 20.670625, 20.665000, 20.661875], 
  [13.165500, 13.195500, 13.229000, 13.311000, 13.425000, 13.590000, 13.731500, 13.867000, 13.976500, 14.107000, 14.267000, 14.416500, 14.558000, 14.717500, 14.918500, 15.141000, 15.410000, 15.683500, 16.018000, 16.375000, 16.658000, 16.900500, 17.194500, 17.434500, 17.724500, 17.979000, 18.230500, 18.578000, 18.891000, 19.203000, 19.448000, 19.704500, 19.922500, 20.071500, 20.190000, 20.327000], 
  [13.386809, 13.380851, 13.384043, 13.393191, 13.428298, 13.497234, 13.552340, 13.609149, 13.648936, 13.704681, 13.762553, 13.802128, 13.842766, 13.897234, 13.975532, 14.054043, 14.147234, 14.251702, 14.380851, 14.522340, 14.642979, 14.756596, 14.898723, 15.030638, 15.205532, 15.396596, 15.571277, 15.789787, 15.974468, 16.164894, 16.340000, 16.506383, 16.651915, 16.782340, 16.908511, 17.046596],  
    ],
    chartData2: [],
    dates: [
      '20240924', '20240925', '20240926', '20240927', '20240928', '20240929',
      '20240930', '20241001', '20241002', '20241003', '20241004', '20241005',
      '20241006', '20241007', '20241008', '20241009', '20241010', '20241011',
      '20241101', '20241102', '20241103', '20241104', '20241105', '20241106',
      '20241101', '20241102', '20241103', '20241104', '20241105', '20241106',
      '20241113', '20241114', '20241115', '20241116', '20241117', '20241118',
      '20241119'
    ],
    dates2: getDateRange('20250102'),
    chartData3: [],
    similarity: 0.8740
  },
  {
    stockIndex: 4,
    stockName: '博菲电器',
    stockCode: '001255',
    stockFrom: '基准股票',
    startDate: '2022-06-23',
    endDate: '2022-08-08',
    chartData: [
      [9.687500, 9.625000, 9.750000, 10.050000, 10.272500, 10.707500, 10.967500, 11.132500, 11.335000, 11.182500, 11.085000, 10.932500, 10.680000, 10.512500, 10.630000, 10.902500, 11.342500, 11.900000, 12.282500, 12.750000, 13.247500, 13.515000, 13.632500, 13.600000, 13.700000, 13.835000, 14.010000, 14.110000, 13.722500, 13.320000, 12.950000, 12.590000, 12.500000], 
  [9.676250, 9.681250, 9.786250, 9.915000, 9.980000, 10.166250, 10.358750, 10.591250, 10.803750, 10.945000, 11.026250, 11.032500, 11.007500, 10.847500, 10.857500, 10.917500, 11.011250, 11.206250, 11.456250, 11.826250, 12.295000, 12.707500, 12.957500, 13.175000, 13.473750, 13.675000, 13.821250, 13.855000, 13.711250, 13.577500, 13.480000, 13.350000, 13.111250], 
  [9.633333, 9.666667, 9.725000, 9.807500, 9.875000, 10.023333, 10.180000, 10.320833, 10.431667, 10.505000, 10.600833, 10.705000, 10.762500, 10.800833, 10.894167, 10.989167, 11.119167, 11.198333, 11.332500, 11.528333, 11.756667, 11.975833, 12.181667, 12.417500, 12.763333, 13.083333, 13.308333, 13.486667, 13.556667, 13.556667, 13.530833, 13.433333, 13.307500], 
  [9.523750, 9.593125, 9.680000, 9.738125, 9.793125, 9.926875, 10.035625, 10.138750, 10.240000, 10.313125, 10.406250, 10.473750, 10.493750, 10.506875, 10.608125, 10.754375, 10.907500, 11.075625, 11.241250, 11.429375, 11.651250, 11.777500, 11.907500, 12.046250, 12.242500, 12.440625, 12.638750, 12.840625, 13.003125, 13.142500, 13.218750, 13.262500, 13.292500], 
  [9.320500, 9.389500, 9.480500, 9.579000, 9.673500, 9.816000, 9.937500, 10.017000, 10.101500, 10.178000, 10.245500, 10.297500, 10.328000, 10.353000, 10.451000, 10.559500, 10.663500, 10.785500, 10.943000, 11.153500, 11.375500, 11.563500, 11.719500, 11.863500, 12.061000, 12.189000, 12.328000, 12.459000, 12.538500, 12.616500, 12.701000, 12.790500, 12.902500],  
  [8.573404, 8.598723, 8.630426, 8.673191, 8.709149, 8.767660, 8.831915, 8.897447, 8.981489, 9.063830, 9.133404, 9.202979, 9.259787, 9.312979, 9.392766, 9.478723, 9.569574, 9.669574, 9.776383, 9.900000, 10.035319, 10.159149, 10.271915, 10.382553, 10.510000, 10.628298, 10.749362, 10.866170, 10.961277, 11.049362, 11.132128, 11.213617, 11.295319], 
    ],
    chartData2: [],
    dates: [
      '20220623', '20220624', '20220625', '20220626', '20220627', '20220628',
      '20220629', '20220630', '20220701', '20220702', '20220703', '20220704',
      '20220705', '20220706', '20220707', '20220708', '20220709', '20220710',
      '20220705', '20220706', '20220707', '20220708', '20220709', '20220710',
      '20220801', '20220802', '20220803', '20220804', '20220805', '20220806',
      '20220807', '20220808'
    ],
    dates2: getDateRange('20250102'),
    chartData3: [],
    similarity: 0.7521
  }
]);
const dataObjects2 = ref([
  {
    searchType: '历史查找',
    searchCount: 0,
    futureTime: '5',
    showCustomInput: false,
    customDays: '',
    futureIncome: 0,
    maxRange: 0,
    maxRate: 0,
    stockIncrease: 0,
    stockDecrease: 0,
    score: 0,
    riseFallRatio: [65, 35] // 上涨65%，下跌35%
  }
]);
const dataObjects3 = ref([
  {
    stockName: '红宝丽',
    stockCode: '002165',
    stockFrom: '系统匹配',
    startDate: '2025-02-27',
    endDate: '2025-03-24',
    chartData: [
      [4.640000, 4.677500, 4.722500, 4.747500, 4.787500, 4.817500, 4.817500, 4.817500, 4.810000, 4.797500, 4.750000, 4.735000, 4.742500, 4.750000, 4.767500, 4.825000, 4.995000, 5.170000], 
  [4.567500, 4.603750, 4.647500, 4.680000, 4.713750, 4.747500, 4.770000, 4.782500, 4.798750, 4.807500, 4.783750, 4.776250, 4.776250, 4.773750, 4.758750, 4.780000, 4.868750, 4.960000],  
  [4.585000, 4.585000, 4.604167, 4.624167, 4.640833, 4.675000, 4.704167, 4.725833, 4.745833, 4.764167, 4.763333, 4.766667, 4.780000, 4.788333, 4.778333, 4.792500, 4.849167, 4.905833],  
  [4.599375, 4.604375, 4.616875, 4.626875, 4.635625, 4.643125, 4.657500, 4.672500, 4.683125, 4.705625, 4.715625, 4.728125, 4.745000, 4.760625, 4.764375, 4.781250, 4.833750, 4.883750],
  [4.587000, 4.592000, 4.605000, 4.622000, 4.637000, 4.647000, 4.657000, 4.665000, 4.670500, 4.674000, 4.676000, 4.685000, 4.695000, 4.714500, 4.726000, 4.747500, 4.795000, 4.842500],  
  [4.502340, 4.500213, 4.506809, 4.511915, 4.517021, 4.521064, 4.529574, 4.530213, 4.536170, 4.539149, 4.539787, 4.545319, 4.556383, 4.568936, 4.584043, 4.605319, 4.635106, 4.665532], 
    ],
    chartData2: [],
    
    dates: [ 
      '20250227', '20250228', '20250301', '20250302', '20250303', '20250304',
      '20250305', '20250306', '20250307', '20250308', '20250309', '20250310',
      '20250323', '20250324', '20250325', '20250326', '20250327', '20250328',
    ],
    chartData3: [],
    similarity: 0.8721 },  
  {
    stockName: '中钢天源',
    stockCode: '002057',
    stockFrom: '系统匹配',
    startDate: '2025-02-18',
    endDate: '2025-03-25',
    chartData: [
      [7.587500, 7.637500, 7.777500, 7.915000, 8.105000, 8.165000, 8.232500, 8.297500, 8.255000, 8.315000, 8.307500, 8.282500, 8.320000, 8.317500, 8.300000, 8.327500, 8.350000, 8.335000, 8.330000, 8.300000, 8.300000, 8.347500, 8.402500, 8.535000, 8.595000, 8.627500],
  [7.608750, 7.646250, 7.710000, 7.771250, 7.846250, 7.901250, 8.005000, 8.106250, 8.180000, 8.240000, 8.270000, 8.290000, 8.287500, 8.316250, 8.303750, 8.305000, 8.335000, 8.326250, 8.315000, 8.313750, 8.325000, 8.341250, 8.366250, 8.417500, 8.447500, 8.487500],
  [7.530833, 7.580000, 7.650833, 7.716667, 7.774167, 7.819167, 7.884167, 7.946667, 7.982500, 8.039167, 8.105833, 8.165000, 8.226667, 8.265833, 8.280000, 8.302500, 8.308333, 8.322500, 8.312500, 8.303333, 8.323333, 8.333333, 8.344167, 8.387500, 8.415000, 8.436667],
  [7.450000, 7.488750, 7.546875, 7.608125, 7.674375, 7.726250, 7.796250, 7.861875, 7.894375, 7.943125, 7.990000, 8.030625, 8.066875, 8.108750, 8.154375, 8.205625, 8.257500, 8.283125, 8.292500, 8.301875, 8.306250, 8.328750, 8.335000, 8.361250, 8.391250, 8.406875],
  [7.405500, 7.437000, 7.482000, 7.528000, 7.581000, 7.624000, 7.684000, 7.746000, 7.790500, 7.844000, 7.898500, 7.946000, 7.979500, 8.018000, 8.052000, 8.090000, 8.123500, 8.154000, 8.189500, 8.224500, 8.266000, 8.296000, 8.314500, 8.348500, 8.364000, 8.388500],
  [7.497447, 7.487872, 7.487234, 7.486383, 7.487660, 7.483830, 7.487660, 7.496383, 7.500426, 7.514043, 7.528085, 7.540426, 7.552340, 7.571489, 7.587660, 7.608511, 7.627234, 7.641489, 7.659149, 7.681915, 7.708936, 7.742128, 7.774681, 7.812340, 7.847021, 7.880213],
    ],
    chartData2: [],
    
    dates: [ 
      '20250218', '20250219', '20250220', '20250221', '20250222', '20250223',
      '20250224', '20250225', '20250302', '20250303', '20250304', '20250305',
      '20250306', '20250307', '20250308', '20250309', '20250310', '20250311',
      
      '20250318', '20250319', '20250320', '20250321', '20250322', '20250323',
      '20250324', '20250325'
    ],
    chartData3: [],
    similarity: 0.8055
  },
      {
    stockName: '百川股份',
    stockCode: '002455',
    stockFrom: '系统匹配',
    startDate: '2025-02-26',
    endDate: '2025-03-25',
    chartData: [
       [7.865000, 7.945000, 7.922500, 8.010000, 8.022500, 8.015000, 8.067500, 8.010000, 7.977500, 7.980000, 7.987500, 8.005000, 8.030000, 8.060000, 8.120000, 8.170000, 8.165000, 8.142500, 8.140000, 8.200000],
  [7.787500, 7.826250, 7.841250, 7.900000, 7.943750, 7.980000, 7.995000, 8.010000, 8.000000, 7.997500, 8.027500, 8.007500, 8.003750, 8.020000, 8.053750, 8.087500, 8.097500, 8.101250, 8.130000, 8.185000],
  [7.780833, 7.802500, 7.802500, 7.836667, 7.865833, 7.889167, 7.916667, 7.936667, 7.955000, 7.980000, 7.992500, 8.008333, 8.010000, 8.018333, 8.058333, 8.061667, 8.057500, 8.060833, 8.082500, 8.125000],
  [7.764375, 7.792500, 7.801875, 7.826250, 7.841250, 7.855625, 7.868750, 7.880000, 7.893750, 7.911875, 7.934375, 7.953750, 7.973750, 8.000000, 8.024375, 8.048750, 8.048750, 8.049375, 8.078750, 8.096250],
  [7.733500, 7.751500, 7.764000, 7.792500, 7.816000, 7.837000, 7.855000, 7.863000, 7.868500, 7.880500, 7.892500, 7.905000, 7.921000, 7.941500, 7.971500, 7.997000, 8.012000, 8.028500, 8.047500, 8.079000],
  [7.701915, 7.693830, 7.682979, 7.684255, 7.684894, 7.683191, 7.681489, 7.671064, 7.664894, 7.665532, 7.669149, 7.671702, 7.680638, 7.694043, 7.715745, 7.742128, 7.761915, 7.778723, 7.801915, 7.828511],
    ],
    chartData2: [],
    
    dates: [ 
      '20250226', '20250227', '20250228', '20250301', '20250302', '20250303',
      '20250304', '20250305', '20250306', '20250307', '20250308', '20250309',
      '20250318', '20250319', '20250320', '20250321', '20250322', '20250323',
      '20250324', '20250327', 
    ],
    chartData3: [],
    similarity: 0.7820
  },
      {
    stockName: '利尔化学',
    stockCode: '002258',
    stockFrom: '系统匹配',
    startDate: '2025-03-06',
    endDate: '2025-03-25',
    chartData: [
       [8.612500, 8.760000, 8.895000, 8.965000, 9.045000, 9.035000, 8.987500, 8.955000, 8.912500, 8.880000, 8.837500, 8.880000, 8.912500, 8.997500],
  [8.468750, 8.543750, 8.638750, 8.730000, 8.828750, 8.897500, 8.941250, 8.960000, 8.978750, 8.957500, 8.912500, 8.917500, 8.912500, 8.938750],
  [8.465000, 8.506667, 8.564167, 8.619167, 8.660833, 8.707500, 8.755000, 8.805000, 8.856667, 8.891667, 8.906667, 8.933333, 8.956667, 8.970833],
  [8.491875, 8.513125, 8.546875, 8.575625, 8.610000, 8.638750, 8.670000, 8.703125, 8.723750, 8.750625, 8.775625, 8.823750, 8.870625, 8.918125],
  [8.491500, 8.517000, 8.551500, 8.580500, 8.602500, 8.617500, 8.635000, 8.651500, 8.670500, 8.687000, 8.703500, 8.738500, 8.761500, 8.800000],
  [8.339149, 8.352340, 8.367872, 8.382340, 8.397234, 8.406383, 8.417021, 8.430638, 8.447234, 8.464043, 8.479362, 8.502766, 8.526596, 8.549362],
    ],
    chartData2: [],
    
    dates: [ 
      '20250306', '20250307', '20250308', '20250309', '20250310', '20250311',
      '20250312', '20250313', '20250314', '20250315', '20250316', '20250317',
      
      '20250324', '20250325'
    ],
    chartData3: [],
    similarity: 0.7201
  },
      {
    stockName: 'ST宇顺',
    stockCode: '002289',
    stockFrom: '系统匹配',
    startDate: '2025-02-26',
    endDate: '2025-03-25',
    chartData: [
      [4.000000, 4.112500, 4.217500, 4.222500, 4.222500, 4.157500, 4.097500, 4.087500, 4.105000, 4.145000, 4.182500, 4.227500, 4.247500, 4.310000, 4.427500, 4.540000, 4.710000, 4.777500, 4.780000, 4.772500],
  [3.941250, 3.987500, 4.046250, 4.080000, 4.111250, 4.135000, 4.157500, 4.155000, 4.163750, 4.151250, 4.140000, 4.157500, 4.176250, 4.227500, 4.305000, 4.383750, 4.478750, 4.543750, 4.603750, 4.656250],
  [3.960000, 3.987500, 4.010833, 4.020000, 4.035000, 4.044167, 4.063333, 4.082500, 4.109167, 4.138333, 4.165833, 4.179167, 4.191667, 4.204167, 4.235833, 4.285000, 4.354167, 4.410833, 4.463333, 4.513333],
  [3.955000, 3.979375, 3.999375, 4.011875, 4.025625, 4.030000, 4.032500, 4.036875, 4.052500, 4.069375, 4.093125, 4.118750, 4.143750, 4.181250, 4.231250, 4.269375, 4.321250, 4.347500, 4.371875, 4.406875],
  [3.911500, 3.943000, 3.976000, 3.993500, 4.008500, 4.015000, 4.019000, 4.027000, 4.041500, 4.053000, 4.062500, 4.075000, 4.091500, 4.117500, 4.160000, 4.203000, 4.257000, 4.300500, 4.341000, 4.370000],
  [3.843830, 3.849574, 3.856809, 3.862340, 3.866170, 3.868723, 3.869362, 3.874255, 3.885532, 3.901489, 3.918723, 3.935106, 3.952128, 3.971702, 3.992553, 4.009574, 4.034681, 4.055745, 4.077872, 4.100638],
    ],
    chartData2: [],
    
    dates: [ 
      '20250226', '20250227', '20250228', '20250301', '20250302', '20250303',
      '20250304', '20250305', '20250306', '20250307', '20250308', '20250309',
      '20250318', '20250319', '20250320', '20250321', '20250322', '20250323',
      '20250324', '20250325'
    ],
    chartData3: [],
    similarity: 0.7064
  },
      {
    stockName: '润丰股份',
    stockCode: '301035',
    stockFrom: '系统匹配',
    startDate: '2025-02-20',
    endDate: '2025-03-25',
    chartData: [
      [49.022500, 49.877500, 51.037500, 51.995000, 52.570000, 52.965000, 52.280000, 51.480000, 51.080000, 50.872500, 50.947500, 51.627500, 52.272500, 52.780000, 52.982500, 53.342500, 53.805000, 54.297500, 55.317500, 55.582500, 55.375000, 55.535000, 56.035000, 56.865000],
  [48.456250, 48.781250, 49.526250, 50.241250, 50.796250, 51.421250, 51.658750, 51.737500, 51.825000, 51.918750, 51.613750, 51.553750, 51.676250, 51.826250, 51.965000, 52.485000, 53.038750, 53.538750, 54.150000, 54.462500, 54.590000, 54.916250, 55.676250, 56.223750],
  [48.430833, 48.572500, 49.039167, 49.442500, 49.827500, 50.175833, 50.444167, 50.654167, 50.890833, 51.238333, 51.421667, 51.700833, 51.974167, 52.205833, 52.070000, 52.150000, 52.385833, 52.650000, 53.082500, 53.517500, 53.817500, 54.204167, 54.778333, 55.263333],
  [48.110000, 48.398125, 48.885000, 49.258750, 49.465625, 49.670625, 49.849375, 49.951875, 50.140625, 50.350000, 50.570000, 50.897500, 51.236250, 51.623750, 51.811875, 52.111250, 52.431875, 52.728750, 52.881875, 53.008125, 53.133125, 53.371250, 53.820625, 54.354375],
  [47.694500, 47.950500, 48.326500, 48.700500, 49.002000, 49.311500, 49.564000, 49.703000, 49.788500, 49.911000, 50.069000, 50.287000, 50.567000, 50.836000, 51.052500, 51.386500, 51.750000, 52.158500, 52.513000, 52.805500, 53.020500, 53.290000, 53.512500, 53.779500],
  [47.576809, 47.577447, 47.655532, 47.728936, 47.770851, 47.845745, 47.904043, 47.948511, 47.997021, 48.072553, 48.157447, 48.295532, 48.437021, 48.575957, 48.660638, 48.771489, 48.904468, 49.045532, 49.263191, 49.470638, 49.653617, 49.886383, 50.174894, 50.472979],
    ],
    chartData2: [],
    
    dates: [ 
      '20250220', '20250221', '20250222', '20250223', '20250224', '20250225',
      '20250302', '20250303', '20250304', '20250305', '20250306', '20250307',
      '20250308', '20250309', '20250310', '20250311', '20250312', '20250313',
      '20250318', '20250319', '20250320', '20250321', 
      '20250324', '20250325'
    ],
    chartData3: [],
    similarity: 0.6332 },
      {
    stockName: '杨杰科技',
    stockCode: '300373',
    stockFrom: '系统匹配',
    startDate: '2025-02-20',
    endDate: '2025-03-12',
    chartData: [
      [44.697500, 45.130000, 45.862500, 46.237500, 46.442500, 46.375000, 45.740000, 45.295000, 45.292500, 45.355000, 46.077500, 46.762500, 47.100000, 47.655000, 48.422500],
  [44.732500, 45.015000, 45.115000, 45.368750, 45.570000, 45.752500, 45.801250, 45.766250, 45.867500, 45.865000, 45.908750, 46.028750, 46.196250, 46.505000, 47.250000],
  [44.585833, 44.820833, 44.981667, 45.149167, 45.302500, 45.468333, 45.323333, 45.344167, 45.477500, 45.620000, 45.893333, 46.098333, 46.278333, 46.461667, 46.746667],
  [44.399375, 44.539375, 44.696250, 44.853750, 45.050000, 45.209375, 45.171250, 45.185625, 45.300000, 45.440000, 45.511875, 45.698750, 45.883125, 46.128750, 46.525625],
  [44.185000, 44.383000, 44.532500, 44.696000, 44.808000, 44.906500, 44.905000, 44.942000, 45.098500, 45.238500, 45.352500, 45.501000, 45.660000, 45.883000, 46.094000],
  [44.185106, 44.213617, 44.234255, 44.254468, 44.267447, 44.275319, 44.255957, 44.264681, 44.278085, 44.280426, 44.282340, 44.317660, 44.324468, 44.361702, 44.410213],
    ],
    chartData2: [],
    
    dates: [ 
      '20250220', '20250221', '20250222', '20250223', '20250224', '20250225',
      '20250302', '20250303', '20250304', '20250305', 
      '20250308', '20250309', '20250310', '20250311', '20250312'
    ],
    chartData3: [],
    similarity: 0.6002
  },
      {
    stockName: '航天智造',
    stockCode: '300446',
    stockFrom: '系统匹配',
    startDate: '2025-02-19',
    endDate: '2025-03-25',
    chartData: [
      [17.447500, 17.727500, 18.030000, 18.360000, 18.322500, 18.440000, 18.417500, 18.167500, 18.182500, 18.237500, 18.535000, 19.022500, 19.265000, 19.430000, 19.342500, 19.285000, 19.187500, 19.172500, 19.227500, 19.312500, 19.467500, 19.660000, 19.812500, 19.810000, 19.860000],
  [17.528750, 17.586250, 17.702500, 17.782500, 17.885000, 18.083750, 18.223750, 18.263750, 18.252500, 18.338750, 18.476250, 18.595000, 18.723750, 18.833750, 18.938750, 19.153750, 19.226250, 19.301250, 19.285000, 19.298750, 19.327500, 19.416250, 19.520000, 19.561250, 19.663750],
  [17.448333, 17.565833, 17.700833, 17.776667, 17.793333, 17.870833, 17.940833, 17.910833, 17.984167, 18.135000, 18.327500, 18.516667, 18.590000, 18.702500, 18.765000, 18.825000, 18.878333, 18.946667, 19.035000, 19.206667, 19.306667, 19.420833, 19.460833, 19.469167, 19.505000],
  [17.336250, 17.408750, 17.506250, 17.603750, 17.666875, 17.784375, 17.880000, 17.874375, 17.890625, 17.962500, 18.089375, 18.188750, 18.304375, 18.458750, 18.581250, 18.708750, 18.739375, 18.820000, 18.880625, 18.946875, 19.025625, 19.125000, 19.229375, 19.357500, 19.445000],
  [17.220500, 17.318500, 17.403500, 17.481000, 17.533500, 17.615000, 17.688500, 17.716500, 17.770000, 17.875000, 18.011000, 18.104000, 18.165500, 18.256000, 18.340000, 18.408000, 18.481000, 18.601500, 18.710500, 18.829500, 18.885000, 18.988000, 19.067000, 19.119500, 19.192500],
  [17.053617, 17.067660, 17.093830, 17.086809, 17.073830, 17.071277, 17.072128, 17.067021, 17.088085, 17.122553, 17.173830, 17.209574, 17.261489, 17.316170, 17.370213, 17.410000, 17.439787, 17.488936, 17.551702, 17.625957, 17.705532, 17.805106, 17.894255, 17.974894, 18.056809],
    ],
    chartData2: [],
    
    dates: [ 
      '20250219', '20250220', '20250221', '20250222', '20250223', '20250224',
      '20250225', '20250302', '20250303', '20250304', '20250305', '20250306',
      '20250307', '20250308', '20250309', '20250310', '20250311', '20250312',
      '20250318', '20250319', '20250320', '20250321', '20250322', 
      '20250324', '20250325'
    ],
    chartData3: [],
    similarity: 0.5782
  },
      {
    stockName: '久之洋',
    stockCode: '300516',
    stockFrom: '系统匹配',
    startDate: '2025-03-04',
    endDate: '2025-03-25',
    chartData: [
      [33.502500, 33.647500, 34.227500, 34.617500, 34.847500, 35.295000, 35.482500, 36.085000, 36.452500, 36.572500, 36.775000, 36.440000, 36.455000, 37.160000, 37.665000, 38.335000],
  [33.696250, 33.743750, 33.848750, 33.980000, 34.175000, 34.471250, 34.855000, 35.351250, 35.650000, 35.933750, 36.128750, 36.262500, 36.453750, 36.866250, 37.220000, 37.387500],
  [33.432500, 33.547500, 33.794167, 33.959167, 34.080000, 34.260833, 34.393333, 34.681667, 34.934167, 35.171667, 35.495000, 35.714167, 35.918333, 36.342500, 36.640833, 36.953333],
  [33.341250, 33.410000, 33.495000, 33.623125, 33.786250, 33.984375, 34.216250, 34.490625, 34.673125, 34.838750, 34.988750, 35.121250, 35.314375, 35.668750, 36.037500, 36.369375],
  [33.243000, 33.368500, 33.466500, 33.554000, 33.642500, 33.787000, 33.892500, 34.115500, 34.319500, 34.502000, 34.728000, 34.880500, 35.029500, 35.303000, 35.524000, 35.764000],
  [33.298511, 33.261489, 33.213617, 33.192340, 33.178085, 33.204894, 33.206170, 33.238723, 33.277234, 33.337872, 33.419574, 33.519149, 33.634681, 33.793404, 33.930426, 34.067234],
    ],
    chartData2: [],
    
    dates: [ 
      '20250304', '20250305', '20250306', '20250307', '20250308', '20250309',
      '20250310', '20250311', '20250312', '20250313', '20250314', '20250315',
       '20250320', '20250321',
      '20250324', '20250325'
    ],
    chartData3: [],
    similarity: 0.5722
  },
   {
    stockName: '金力泰',
    stockCode: '300225',
    stockFrom: '系统匹配',
    startDate: '2025-03-17',
    endDate: '2025-03-25',
    chartData: [
        [7.022500, 7.077500, 7.140000, 7.155000, 7.157500, 7.120000, 7.105000],
        [7.028750, 7.027500, 7.033750, 7.062500, 7.090000, 7.098750, 7.122500],
        [7.036667, 7.060000, 7.070833, 7.061667, 7.071667, 7.058333, 7.057500],
        [7.030000, 7.040000, 7.047500, 7.056250, 7.066875, 7.075000, 7.079375],
        [6.990000, 7.009000, 7.024000, 7.040000, 7.055500, 7.056000, 7.059000],
        [6.955532, 6.974468, 6.995957, 7.018085, 7.029574, 7.039574, 7.049149],
    ],
    chartData2: [],
    dates: [ 
      '20250317', '20250318', '20250319', '20250320',
      '20250323', '20250324', '20250325'
    ],
    chartData3: [],
    similarity: 0.4473
  },
]);

// 处理选择器变化
const handleSelectChange = (row) => {
  row.showCustomInput = false
  row.customDays = ''
  if (row.futureTime === 'custom') {
    row.showCustomInput = true
  }
  console.log(`用户选择了: ${row.futureTime}`)
}

// 处理自定义时间输入
const handleCustomInput = (row) => {
  if (row.customDays && !isNaN(Number(row.customDays))) {
    row.futureTime = Number(row.customDays)
    console.log(`用户自定义时间: ${row.futureTime}天`)
  } else {
    row.futureTime = '3' // 默认恢复为3天
    row.customDays = ''
    console.log('输入无效，恢复默认值')
  }
}

function transposeArray(array) {
    // 检查输入是否为有效的二维数组
    if (!Array.isArray(array) || array.length === 0 || !Array.isArray(array[0])) {
        throw new Error('输入必须是一个非空的二维数组');
    }
    // 获取原数组的行数和列数
    const rows = array.length;
    const cols = array[0].length;
    // 创建一个新的二维数组，行数为原数组的列数，列数为原数组的行数
    const transposed = new Array(cols).fill(0).map(() => new Array(rows).fill(0));
    // 填充转置后的数组
    for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
            transposed[j][i] = array[i][j];
        }
    }
    return transposed;
}

// 创建计算属性而不是直接引用
const tableData = computed(() => dataObjects.value);
const tableData2 = computed(() => dataObjects3.value);
const resultData = computed(() => dataObjects2.value);

// 传入的是股票基准模式的数据
watch(() => store.state.resultList2, (newValue) => {
    console.log("接收结果数据-------------------", toRaw(newValue));
    const rawData = toRaw(newValue);
    const newDataObjects = [];
    let totalSearchCount = 0;

    for (const stockCode in rawData) {
      if (rawData.hasOwnProperty(stockCode)) {
        console.log("股票代码:", stockCode);
        // 获取该股票的所有相似区间数据
        const intervals = rawData[stockCode];
        totalSearchCount += intervals.length;

        // 遍历每个相似区间
        intervals.forEach((interval) => {
          const stock = store.state.stockList.find(stock => stock.code === stockCode.slice(0, 6));
          const ma_values1 = transposeArray(interval.ma_values);
          const index_values = transposeArray(interval.index_ma_values);
          const dates = interval.x_axis_dates;
          const digits = dates.map(date => date.slice(-4));
          const future_value = transposeArray(interval.post_ma_values.slice(0, 10));

          const newData = {
            stockName: stock ? stock.name : '未知股票',
            stockCode: stockCode.slice(0, 6),
            stockFrom: '基准股票',
            startDate: interval.start_date,
            endDate: interval.end_date,
            chartData: ma_values1,
            chartData2: index_values,
            dates: digits,
            dates2: interval.post_dates.slice(0, 10),
            chartData3: future_value,
            similarity: interval.similarity.toFixed(6)
          };
          newDataObjects.push(newData);
        });
      }
    }

    const newResultData = [{
      searchType: '基准股票模式查找',
      searchCount: totalSearchCount,
      futureTime: '5',
      showCustomInput: false,
      customDays: '',
      futureIncome: store.state.resultInfo.futureIncome * 100,
      maxRange: 0,
      maxRate: 0,
      stockIncrease: 0,
      stockDecrease: 0,
      score: 0,
      riseFallRatio: [65, 35]
    }];

    // 直接更新数据对象
    dataObjects.value = newDataObjects;
    dataObjects2.value = newResultData;
    console.log('表格数据已更新');
  },
  { deep: true } // 若 resultList 是对象或数组，需要深度监听
);

// 传入的是推荐模式【金叉】的结果数据
watch(() => store.state.resultList, (newValue) => {
    console.log("接收结果数据-------------------", toRaw(newValue));
    const rawData = toRaw(newValue);
    const newDataObjects = [];
    let totalSearchCount = 0;

    for (const stockCode in rawData) {
      if (rawData.hasOwnProperty(stockCode)) {
        console.log("股票代码:", stockCode);
        // 获取该股票的所有相似区间数据
        const intervals = rawData[stockCode];
        totalSearchCount += intervals.length;

        // 遍历每个相似区间
        intervals.forEach((interval) => {
          const stock = store.state.stockList.find(stock => stock.code === stockCode.slice(0, 6));
          const ma_values1 = transposeArray(interval.ma_data.map(subArray => subArray.slice(1)));
          const index_values = transposeArray(interval.index_ma_values);
          const dates = interval.ma_data.map(item => item[0]);
          const digits = dates.map(date => date.slice(-4));
          const future_value = transposeArray(interval.post_stock_ma_data.slice(0, 10).map(subArray => subArray.slice(1)));

          const newData = {
            stockName: stock ? stock.name : '未知股票',
            stockCode: stockCode.slice(0, 6),
            stockFrom: '基准股票',
            startDate: interval.interval[0],
            endDate: interval.interval[1],
            chartData: ma_values1,
            chartData2: index_values,
            dates: digits,
            dates2: interval.post_stock_dates.slice(0, 10),
            chartData3: future_value,
            similarity: 1
          };
          newDataObjects.push(newData);
        });
      }
    }

    const newResultData = [{
      searchType: '基准股票模式查找',
      searchCount: totalSearchCount,
      futureTime: '5',
      showCustomInput: false,
      customDays: '',
      futureIncome: store.state.resultInfo.futureIncome * 100,
      maxRange: 0,
      maxRate: 0,
      stockIncrease: 0,
      stockDecrease: 0,
      score: 0,
      riseFallRatio: [65, 35]
    }];

    // 直接更新数据对象
    dataObjects.value = newDataObjects;
    dataObjects2.value = newResultData;
    console.log('表格数据已更新');
  },
  { deep: true } // 若 resultList 是对象或数组，需要深度监听
);

// 页面加载时检查是否已有数据
onMounted(() => {
  if (store.state.resultList && Object.keys(store.state.resultList).length > 0) {
    const rawData = toRaw(store.state.resultList);
    const newDataObjects = [];
    let totalSearchCount = 0;

    for (const stockCode in rawData) {
      if (rawData.hasOwnProperty(stockCode)) {
        const intervals = rawData[stockCode];
        totalSearchCount += intervals.length;

        intervals.forEach((interval) => {
          const stock = store.state.stockList.find(stock => stock.code === stockCode.slice(0, 6));
          const ma_values1 = transposeArray(interval.ma_data);
          const index_values = transposeArray(interval.index_ma_values);
          const dates = interval.ma_data.map(item => item[0]);
          const digits = dates.map(date => date.slice(-4));
          const future_value = transposeArray(interval.post_stock_ma_data.slice(0, 10));

          const newData = {
            stockName: stock ? stock.name : '未知股票',
            stockCode: stockCode.slice(0, 6),
            stockFrom: '基准股票',
            startDate: interval.interval[0],
            endDate: interval.interval[1],
            chartData: ma_values1,
            chartData2: index_values,
            dates: digits,
            dates2: interval.post_stock_dates.slice(0, 10),
            chartData3: future_value,
            similarity: 1
          };
          newDataObjects.push(newData);
        });
      }
    }

    const newResultData = [{
      searchType: '基准股票模式查找',
      searchCount: totalSearchCount,
      futureTime: '5',
      showCustomInput: false,
      customDays: '',
      futureIncome: store.state.resultInfo.futureIncome * 100,
      maxRange: 0,
      maxRate: 0,
      stockIncrease: 0,
      stockDecrease: 0,
      score: 0,
      riseFallRatio: [65, 35]
    }];

    // 直接更新数据对象
    dataObjects.value = newDataObjects;
    dataObjects2.value = newResultData;
    console.log('表格数据已更新');
    
    // 强制更新表格
    nextTick(() => {
      console.log('表格数据长度:', tableData.value.length);
    });
  }
});

const chartRefs = ref(Array(dataObjects.value.length * 3).fill(null));

const setChartRef = (el, rowIndex, colIndex) => {
  const index = rowIndex * 3 + colIndex;
  chartRefs.value[index] = el;
  if(isHistorySearch.value === true)
  {
    initChart(index, rowIndex, colIndex);
  }
  if(isChooseStock.value === true)
  {
    initChart3(index, rowIndex, colIndex);
  }
  // if (index % 3 === 0 || index % 3 === 1) {
  //   initChart(index, rowIndex, colIndex);
  // }
  // if (index % 3 === 2) {
  //   initChart2(index, rowIndex, colIndex);
  // }
};

const setChartRef2 = (el, rowIndex, colIndex) => {
  // const index = rowIndex * 3 + colIndex;
  // chartRefs.value[index] = el;
  // if(isHistorySearch.value === true)
  // {
  //   initChart(index, rowIndex, colIndex);
  // }
  // if(isChooseStock.value === true)
  // {
  //   initChart3(index, rowIndex, colIndex);
  // }
};

const initChart = (index, rowIndex, colIndex, retryCount = 0) => {
  if (chartRefs.value[index]) {
    try {
      const myChart = echarts.init(chartRefs.value[index]);
      let chartData;
      if (colIndex === 0) {
        chartData = dataObjects.value[rowIndex].chartData;
      } else if (colIndex === 1) {
        chartData = dataObjects.value[rowIndex].chartData2;
      }
      // 计算所有数据中的最小值和最大值
      const allValues = [].concat(...chartData);
      const minValue = Math.min(...allValues);
      const maxValue = Math.max(...allValues);
      // 添加一些边距，使图表更美观
      const padding = (maxValue - minValue) * 0.1;
      
      const option = {
        xAxis: {
          type: 'category',
          data: dataObjects.value[rowIndex].dates,
        },
        yAxis: {
          type: 'value',
          axisTick: { show: false }, // 隐藏 y 轴刻度
          axisLabel: { show: false }, // 隐藏 y 轴坐标值
          min: minValue - padding,    // 设置纵轴最小值
          max: maxValue + padding     // 设置纵轴最大值
        },
        series: [
          {
            name: 'MA4',
            data: chartData[0],
            type: 'line',
            lineStyle: { width: 1, color:'#cd1f0e' },// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA8',
            data: chartData[1],
            type: 'line',
            lineStyle: { width: 1 , color:'#edbf09'},// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA12',
            data: chartData[2],
            type: 'line',
            lineStyle: { width: 1 ,color:'#62c613'},// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA16',
            data: chartData[3],
            type: 'line',
            lineStyle: { width: 1, color:'#1286ff' },// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA20',
            data: chartData[4],
            type: 'line',
            lineStyle: { width: 1 ,color:'#9f12ff'},// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA47',
            data: chartData[5],
            type: 'line',
            lineStyle: { width: 1,color:'#000000' },// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
        ]
      };
      myChart.setOption(option);
    } catch (error) {
      console.error('ECharts 初始化出错:', error);
    }
  } else if (retryCount < 5) {
    setTimeout(() => {
      initChart(index, rowIndex, colIndex, retryCount + 1);
    }, 500);
  } else {
    console.log(`chartRef 未获取到元素: ${index}，重试次数达到上限`);
  }
};

const initChart3 = (index, rowIndex, colIndex, retryCount = 0) => {
  if (chartRefs.value[index]) {
    try {
      const myChart = echarts.init(chartRefs.value[index]);
      let chartData;
      if (colIndex === 0) {
        chartData = dataObjects3.value[rowIndex].chartData;
      } else if (colIndex === 1) {
        chartData = dataObjects3.value[rowIndex].chartData2;
      }
      // 计算所有数据中的最小值和最大值
      const allValues = [].concat(...chartData);
      const minValue = Math.min(...allValues);
      const maxValue = Math.max(...allValues);
      // 添加一些边距，使图表更美观
      const padding = (maxValue - minValue) * 0.1;
      
      const option = {
        xAxis: {
          type: 'category',
          data: dataObjects3.value[rowIndex].dates,
        },
        yAxis: {
          type: 'value',
          axisTick: { show: false }, // 隐藏 y 轴刻度
          axisLabel: { show: false }, // 隐藏 y 轴坐标值
          min: minValue - padding,    // 设置纵轴最小值
          max: maxValue + padding     // 设置纵轴最大值
        },
        
        series: [
          {
            name: 'MA4',
            data: chartData[0],
            type: 'line',
            lineStyle: { width: 1, color:'#cd1f0e' },// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA8',
            data: chartData[1],
            type: 'line',
            lineStyle: { width: 1 , color:'#edbf09'},// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA12',
            data: chartData[2],
            type: 'line',
            lineStyle: { width: 1 ,color:'#62c613'},// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA16',
            data: chartData[3],
            type: 'line',
            lineStyle: { width: 1, color:'#1286ff' },// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA20',
            data: chartData[4],
            type: 'line',
            lineStyle: { width: 1 ,color:'#9f12ff'},// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA47',
            data: chartData[5],
            type: 'line',
            lineStyle: { width: 1,color:'#000000' },// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
        ]
      };
      myChart.setOption(option);
    } catch (error) {
      console.error('ECharts 初始化出错:', error);
    }
  } else if (retryCount < 5) {
    setTimeout(() => {
      initChart3(index, rowIndex, colIndex, retryCount + 1);
    }, 500);
  } else {
    console.log(`chartRef 未获取到元素: ${index}，重试次数达到上限`);
  }
};

const initChart2 = (index, rowIndex, colIndex, retryCount = 0) => {
  if (chartRefs.value[index]) {
    try {
      const myChart = echarts.init(chartRefs.value[index]);
      let chartData;
      chartData = dataObjects.value[rowIndex].chartData3;

      // 计算所有数据中的最小值和最大值
      const allValues = [].concat(...chartData);
      const minValue = Math.min(...allValues);
      const maxValue = Math.max(...allValues);
      // 添加一些边距，使图表更美观
      const padding = (maxValue - minValue) * 0.1;
      
      const option = {
        xAxis: {
          type: 'category',
          data: dataObjects.value[rowIndex].dates2,
        },
        yAxis: {
          type: 'value',
          axisTick: { show: false }, // 隐藏 y 轴刻度
          axisLabel: { show: false }, // 隐藏 y 轴坐标值
          min: minValue - padding,    // 设置纵轴最小值
          max: maxValue + padding     // 设置纵轴最大值
        },
        legend: {
          data: ['MA4', 'MA12', 'MA20'],
          top: '20%' ,
          left: 'left',
          orient: 'vertical',
          itemWidth: 8,
          itemHeight: 8,
          iconSize: 8,
          textStyle: {
            color: '#000',
            fontSize: 9
          }
        },
        series: [
          {
            name: 'MA4',
            data: chartData[0],
            type: 'line',
            lineStyle: { width: 1 },// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA12',
            data: chartData[1],
            type: 'line',
            lineStyle: { width: 1 },// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          },
          {
            name: 'MA20',
            data: chartData[2],
            type: 'line',
            lineStyle: { width: 1 },// 减小曲线粗细
            showSymbol: false // 新增配置，去掉数据圆点
          }
        ]
      };
      myChart.setOption(option);
    } catch (error) {
      console.error('ECharts 初始化出错:', error);
    }
  } else if (retryCount < 5) {
    setTimeout(() => {
      initChart2(index, rowIndex, colIndex, retryCount + 1);
    }, 500);
  } else {
    console.log(`chartRef 未获取到元素: ${index}，重试次数达到上限`);
  }
};

</script>

<style scoped>
/* 可根据需要添加样式 */
.result-table {
  margin-left: 30px;
  margin-top: 20px;
}
</style>